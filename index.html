<!DOCTYPE html>
<html>
<head>
<link href="css/bootstrap.min.css" rel="stylesheet"/>
<script type='text/javascript' src='js/jquery.min.js'></script>
<script type='text/javascript' src='js/d3.min.js'></script>
<script src="http:	//d3js.org/topojson.v1.min.js"></script>	
<script type='text/javascript' src='js/bootstrap.min.js'></script>
<script language="javascript">

var regions =["Africa","Asia","Europe","North America","Oceania","South America"];

var  points = [{"lat":-75.5,"lon": 40.1,"pitch":80},{"lat":0,"lon":0,"pitch":4}]

var active = d3.select(null);

var svg;
var projection;
var path;
var width = 960;
var height = 500;	
function initialize() {
	projection=d3.geoMercator();
	/*	.scale(500)
		.translate([width/2,height/2]);*/
			
	path=d3.geoPath()
		.projection(projection);


	svg = d3.select("#tiltMap").append("svg")
    .attr("width", width)
    .attr("height", height);
	/*g = svg.append("g");*/
	
	d3.json("countryData/world.json", function(error, world) {
		if (error) return console.error(error);
		console.log(world);
		var subunits=topojson.feature(world, world.objects.subunits);
		
		for (var i=0, len=regions.length;i < len; i++) {
			g=svg.append("g").attr("id",regions[i]);
			
			g.selectAll(".subunit")
			.data(topojson.feature(world, world.objects.subunits).features.filter(function(d) { return d.properties.continent==regions[i];}))
			.enter()
				.append("path")
				.attr("class", function(d) {return "subunit " + d.id;})
				.attr("d",path)
				/*.on("click", clicked);*/
		
			
			if (regions[i] == "North America") {
				g.append("path")
				.datum(topojson.mesh(world, world.objects.states, function(a,b) {return a != b && a.id == "USA";}))
				.attr("class", "state-boundary")
				.attr("stroke", "black")
				.attr("fill","none")
				.attr("d", path);
			}
		}
		
		g.append("path")
				.datum(topojson.mesh(world, world.objects.subunits))
				.attr("class", "subunit-boundary")
				.attr("stroke", "black")
				.attr("fill","none")
				.attr("d", path);
		
			
		svg.selectAll(".device")
		.data(points)
		.enter()
			.append("circle")
				.attr("r",function(d) {return d.pitch/10;})
				.attr("transform", function(d) {return "translate(" + projection([d.lat,d.lon]) + ")";})
				.attr("class", "device")
		.exit()
			.remove();
	});

		

function clicked(d) {
  if (active.node() === this) return reset();
  active.classed("active", false);
  active = d3.select(this).classed("active", true);
  var bounds = path.bounds(d),
      dx = bounds[1][0] - bounds[0][0],
      dy = bounds[1][1] - bounds[0][1],
      x = (bounds[0][0] + bounds[1][0]) / 2,
      y = (bounds[0][1] + bounds[1][1]) / 2,
      scale = .9 / Math.max(dx / width, dy / height),
      translate = [width / 2 - scale * x, height / 2 - scale * y];


  g.transition()
      .duration(750)
      .style("stroke-width", 1.5 / scale + "px")
      .attr("transform", "translate(" + translate + ")scale(" + scale + ")");
}

function reset() {
  active.classed("active", false);
  active = d3.select(null);

var g=d3.select("g");
  g.transition()
      .duration(750)
      .style("stroke-width", "1.5px")
      .attr("transform", "");
}


}
</script>
<style>
.subunit { fill: #ddd;}


}


</style>
</head>
<body>
	<nav class="navbar navbar-inverse">
		<div class="container-fluid">
			<div class="navbar-header">
			  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			  </button>
			  <a class="navbar-brand" href="#">Tilt Visualization</a>
			  
			</div>
			<img class="col-xs-3" src="images/federation-bar.png"/>
			<div id="navbar" class="navbar-collapse collapse">

			  <ul class="nav navbar-nav navbar-right">
				<li><a onClick='loadViz("Pitch")'><span class="glyphicon glyphicon glyphicon-sort nav-glyph" aria-hidden="true"></span> Pitch</a></li>
				<li class="dropdown">
					<a class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
						<span class="glyphicon glyphicon-globe nav-glyph" aria-hidden="true"></span> 
						Location
						</a>
					<ul class="dropdown-menu" role="menu">
						<li><a role="menuitem" onClick='focusMap("Africa")'>Africa</a></li>
						<li><a role="menuitem" onClick='focusMap("Asia")'>Asia</a></li>
						<li><a role="menuitem" onClick='focusMap("Central America")'>Central America</a></li>
						<li><a role="menuitem" onClick='focusMap("Europe")'>Europe</a></li>
						<li><a role="menuitem" onClick='focusMap("North America")'>North America</a></li>
						<li><a role="menuitem" onClick='focusMap("Oceania")'>Oceania</a></li>
						<li><a role="menuitem" onClick='focusMap("South America")'>South America</a></li>
					</ul>
				</li>
			  </ul>
			</div>
		  </div>
    </nav>
	<div class="container-fluid" id="mainScreen">
		<div id='tiltMap' class="row col-xs-12"></div>
	</div>
	<script>
	window.onload=initialize();
	</script>
	<link href="css/tilt-map.css" rel="stylesheet"/>
</body>
</html>

